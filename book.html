<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.3" />
<title></title>
<style type="text/css">
/* Sans-serif font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
div#toctitle,
span#author, span#revnumber, span#revdate, span#revremark,
div#footer {
  font-family: Arial,Helvetica,sans-serif;
}

/* Serif font. */
div.sectionbody {
  font-family: Georgia,"Times New Roman",Times,serif;
}

/* Monospace font. */
tt {
  font-size: inherit;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  font-size: inherit;
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
}

div#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes(); asciidoc.toc(2);}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body class="article" style="max-width:55em">
<div id="header">
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="paragraph"><p>AsciiDoc is a text document format for writing notes, documentation, articles, books, ebooks, slideshows, web pages, man pages and blogs. AsciiDoc files can be translated to many formats including HTML, PDF, EPUB, man page.</p></div>
<div class="sect1">
<h2 id="setup-environment">Setting up your editing environment</h2>
<div class="sectionbody">
<div class="paragraph"><p>This doc describes how to set up an environment on a Mac to write for Maker Press.  (Or, I should say, it&#8217;s my running notes for it.)  Depending on your system, you might have a bit of work to do to get things up and going.  So, take this document with a grain of salt.</p></div>
<div class="paragraph"><p>We&#8217;ll need to do a few things to get going:</p></div>
<div class="ulist"><ul>
<li>
<p>
Install MacPorts to make it easy to get new packages
</p>
</li>
<li>
<p>
Install git and asciidoc, which is a package for formatting text
</p>
</li>
<li>
<p>
Install TextMate, as well as a few bundles
</p>
</li>
</ul></div>
<div class="paragraph"><p>The following sections explain this in more detail.</p></div>
<div class="sect2">
<h3 id="_preliminaries">Preliminaries</h3>
<div class="paragraph"><p>You will need the XCode development tools and X11 (which comes on some Macs).  Next, you&#8217;ll need MacPorts, which makes it much easier to install everything you&#8217;ll need.  You can find it at the <a href="http://www.macports.org/install.php">MacPorts</a> website, which has all the instructions you need to install it for your system.</p></div>
<div class="listingblock" id="NOTE">
<div class="content">
<pre><tt>One annoyance I had on MacPorts is that it lists the OS versions by name, rather than number, which I found annoying.  You can find your OS version by clicking the Apple at the top left corner and then selecting "About this Mac" and then find the corresponding name using the list below (from Wikipedia):

* Version 10.0: "Cheetah"
* Version 10.1: "Puma"
* Version 10.2: "Jaguar"
* Version 10.3: "Panther"
* Version 10.4: "Tiger"
* Version 10.5: "Leopard"
* Version 10.6: "Snow Leopard"
* Version 10.7: "Lion"</tt></pre>
</div></div>
<div class="paragraph"><p>Then make sure your PATH is correct in ~/.profile. So here are the two lines you&#8217;ll want (updating for your username):</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>PATH=$PATH:/opt/local/bin:/opt/local/sbin:/Applications:/Applications/Utilities:/usr/local/bin:/Users/adam/bin
export PATH</tt></pre>
</div></div>
<div class="sect3">
<h4 id="_git">Git</h4>
<div class="paragraph"><p>If you don&#8217;t already have git, you can use MacPorts to install it.  Just drop into the terminal and type:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$ sudo port install git</tt></pre>
</div></div>
<div class="paragraph"><p>It should fire up and install with no problems.</p></div>
</div>
<div class="sect3">
<h4 id="_asciidoc_a2x_8_6_4">asciidoc, a2x (8.6.4)</h4>
<div class="paragraph"><p>Asciidoc refers to two different things: a wiki-like <strong>markup language</strong> you can write in, and the various <strong>tools</strong> that convert that markup into various other formats.  This section describes how to set up the tools.  You can probably already see the punchline coming, but here&#8217;s how you set up the asciidoc tools on your system:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$sudo port install asciidoc</tt></pre>
</div></div>
<div class="paragraph"><p>The downside of this is that this step takes a <strong>very</strong> long time&#8201;&#8212;&#8201;maybe an hour or so.  So, be prepared to run it and then go out and get some coffee.  Or, two coffees.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_textmate">Textmate</h3>
<div class="paragraph"><p>You can edit your documents in whatever editor you like&#8201;&#8212;&#8201;vi, emacs, or whatever.  I&#8217;ve been using <a href="http://macromates.com/">TextMate</a>, an editor for the Mac that is popular in the developer community.  It costs about $60 U.S., but it&#8217;s got some addictive features that make it worth the price.  Plus, you can try it our for free for 30 days.</p></div>
<div class="paragraph"><p>On of the coolest features of TextMate is that it offers a <em>bundles</em>&#8201;&#8212;&#8201;collections of macros, commands, snippets, drag commands, templates, preferences, and language grammars&#8201;&#8212;&#8201;that make development much quicker.  There are two main bundles I&#8217;ve been using:</p></div>
<div class="sect3">
<h4 id="_install_the_asciidoc_bundle">Install the asciidoc bundle</h4>
<div class="paragraph"><p>The <a href="https://github.com/zuckschwerdt/asciidoc.tmbundle">AsciiDoc bundle</a> makes it much easier to work with AsciiDoc in textmate by offering things like automatic previews, source highlighting, and so forth.  Here&#8217;s what you do:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>mkdir -p /Library/Application\ Support/TextMate/Bundles
cd ~/"Library/Application Support/TextMate/Bundles/"
git clone git://github.com/zuckschwerdt/asciidoc.tmbundle.git "AsciiDoc.tmbundle"
osascript -e 'tell app "TextMate" to reload bundles'</tt></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_install_the_git_bundle">Install the git bundle</h4>
<div class="paragraph"><p>The <a href="http://gitorious.org/git-tmbundle">git bundle</a> allows you to save stuff in git right from within TextMate.  Not sure what this buys me yet, but here are the commands:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>mkdir -p /Library/Application\ Support/TextMate/Bundles
cd !$
git clone http://git.gitorious.org/git-tmbundle/mainline.git Git.tmbundle
osascript -e 'tell app "TextMate" to reload bundles'</tt></pre>
</div></div>
<div class="paragraph"><p>You&#8217;ll need to add a path variable to tell TextMate where git is installed.  First, locate git:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$which git
/usr/local/git/bin/git</tt></pre>
</div></div>
<div class="paragraph"><p>Then go to "Preferences &#8594; Advanced" and click the "Shell Variables" tab.  Then add a variable named "TM_GIT".  You can find the path to git using this command sequence:</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-in-asciidoc">Writing in AsciiDoc</h2>
<div class="sectionbody">
<div class="paragraph"><p>As described earlier, <a href="http://www.methods.co.nz/asciidoc/index.html">AsciiDoc</a> is a text document format for writing notes, documentation, articles, books, ebooks, slideshows, web pages, man pages and blogs. The main advantage of AsciiDoc is that it plays well with DocBook, O&#8217;Reilly&#8217;s native content format, but is something that you can actually write in.</p></div>
<div class="paragraph"><p>This <a href="http://powerman.name/doc/asciidoc">Asciidoc cheat sheet</a> covers most of what you&#8217;ll need to know.  As you&#8217;ll see, AsciiDoc is most similar to wiki markup&#8201;&#8212;&#8201;if you can write a wikipedia article, then you&#8217;re pretty much 99% of the way there.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Formatting O&#8217;Reilly books in AscciDoc</div>
<div class="paragraph"><p>You can get the official guide for writing a full O&#8217;Reilly book in AsciiDoc from our Subversion repository:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>svn checkout --username "odewahn@oreilly.com" "https://prod.oreilly.com/internal/books/sandbox_odewahn_RT79726/current/tools/cookbook_demo.pdf"</tt></pre>
</div></div>
<div class="paragraph"><p>I&#8217;ve also placed relevant files into the "samples" directory in this repository.</p></div>
<div class="paragraph"><p>This document (still in R&amp;D, BTW!) tells you how to do pretty much anything you&#8217;d like.  I anticipate that Maer Press will only use a subset of the markup features, but this guide is there if you need it.</p></div>
</td>
</tr></table>
</div>
<div class="sect2">
<h3 id="_editing_files">Editing files</h3>
<div class="paragraph"><p>The best way to get started with AsciiDoc and Maker Press is to pull down the repository for this document (how&#8217;s that for recursion!) and look out how the files are structured.  Here&#8217;s how you can get the repo:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>Need to have a link to the git repository for this doc</tt></pre>
</div></div>
<div class="paragraph"><p>Once you have the files, you can open them in TextMate using the command:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>mate .</tt></pre>
</div></div>
<div class="paragraph"><p>This will open the editor and display the <em>project drawer</em>, which is a navigation tree that you can use to move around between files.  Use the project drawer to open the file called <em>sec_environments.asc</em>, as shown in <a href="#textmate-fig">[textmate-fig]</a>.</p></div>
<div class="imageblock" id="textmate-fig">
<div class="content">
<img src="figs/textmate_editor.png" alt="figs/textmate_editor.png" width="600px" />
</div>
<div class="title">Figure 1. Use TextMate&#8217;s bundle editor to add in the path</div>
</div>
<div class="paragraph"><p>If you&#8217;ve done any wiki markup, this should look pretty familiar.  Also, note how the various AsciiDoc elements are all nicely color coded&#8201;&#8212;&#8201;this is thanks to the AsciiDoc bundle we installed earlier.</p></div>
<div class="paragraph"><p>Muck around in there for a while and make a few changes (remember&#8201;&#8212;&#8201;this is all in your local git repository, so you can&#8217;t hurt anything).  When you&#8217;re ready, you can use the "Bundles &#8594; AsciiDoc &#8594; Preview" to see how your document will look when it is rendered in HTML, as shown in <a href="#asciidoc-preview">[asciidoc-preview]</a>.</p></div>
<div class="imageblock" id="asciidoc-preview">
<div class="content">
<img src="figs/running_preview_bundle.png" alt="figs/running_preview_bundle.png" width="600px" />
</div>
<div class="title">Figure 2. Generating a preview</div>
</div>
<div class="paragraph"><p>The preview will convert the AsciiDoc into HTML as best it can.  If preview identifies any errors, it will flag them as a red hyperlinks that will bring you to the offending line.  For example, <a href="#preview-error">[preview-error]</a> shows how preview has found a broken link to an include file.</p></div>
<div class="imageblock" id="preview-error">
<div class="content">
<img src="figs/preview_error.png" alt="figs/preview_error.png" width="600px" />
</div>
<div class="title">Figure 3. A broken link to an include file shows up as a red hyperlink</div>
</div>
<div class="paragraph"><p>Most times, though, you&#8217;ll have to scan the document and make sure it looks right, just like you would a wiki page.  The advantage of using Preview to clean up your errors is that it will save you time when you try to render the document in the O&#8217;Reilly toolchain.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="title">If you have trouble with Preview, try this first</div>
<div class="paragraph"><p>On my system, there was a weird problem when I tried to run the bundle commands&#8201;&#8212;&#8201;it couldn&#8217;t locate the asciidoc command.  There&#8217;s probably some environment variable or the other that I need to set, but here&#8217;s what I did to fix it.  First, I located where MacPorts installed asciidoc, which you can do by dropping into a terminal and typing this:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$ which asciidoc

/opt/local/bin/asciidoc</tt></pre>
</div></div>
<div class="paragraph"><p>Then go into the bundle editor (Bundles &#8594; Bundle Editor &#8594; Show Bundle Editor) and select the asciidoc bundle.  You can then go into the commands (the have "c" in fromt of them) and add this path in front of everyplace where asciidoc appears.  For example, here&#8217;s the revised version of the "Preview" command:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>if [[ -z $TM_FILENAME ]]
  then doc="-"
  else doc="$TM_FILEPATH"
fi
/opt/local/bin/asciidoc --attribute=imagesdir="file://$(pwd)" --out-file - "$doc" 2&gt;&amp;1 | perl -pe 's%(\w+): .*?: line ([0-9]+):%&lt;b style="color:red"&gt;$1&lt;/b&gt;: &lt;a href="txmt://open/?line=$2"&gt;line $2&lt;/a&gt;:%g'</tt></pre>
</div></div>
<div class="paragraph"><p>It should look something like <a href="#bundle-editor-fig">[bundle-editor-fig]</a> in Textmate.</p></div>
<div class="imageblock" id="bundle-editor-fig">
<div class="content">
<img src="figs/bundle_editor.png" alt="figs/bundle_editor.png" width="600px" />
</div>
<div class="title">Figure 4. Use TextMate&#8217;s bundle editor to add in the path</div>
</div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_generating_a_table_of_contents_toc">Generating a table of contents (TOC)</h3>
<div class="paragraph"><p>You should review your TOC often to make sure that the document is structured correctly.  It&#8217;s really easy to generate this automatically&#8201;&#8212;&#8201;all you have to do is use the bundle editor to add the option "-a toc" to the asciidoc command.</p></div>
<div class="paragraph"><p>Open up the bundle editor (Bundles &#8594; Bundle Editor), select the AsciiDoc bundle, and then click the "Preview" command.  Then, add the put "-a toc" after the AsciiDoc command, as shown in <a href="#add-toc">[add-toc]</a></p></div>
<div class="imageblock" id="add-toc">
<div class="content">
<img src="figs/add_toc.png" alt="figs/add_toc.png" width="600px" />
</div>
<div class="title">Figure 5. Automatically adding a TOC to  Preview</div>
</div>
</div>
<div class="sect2">
<h3 id="_save_your_document_as_an_html_file">Save your document as an html file</h3>
<div class="paragraph"><p>AsciiDoc has options to create stand-alone documents containing embedded images, stylesheets and scripts. The following AsciiDoc command creates a single file containing embedded images, CSS stylesheets, and JavaScript (for table of contents and footnotes):</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$ asciidoc -a data-uri -a icons -a toc -a max-width=55em article.txt</tt></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-orm-svn">Using the ORM SVN repo</h2>
<div class="sectionbody">
<div class="paragraph"><p>O&#8217;Reilly&#8217;s production department uses Subversion to manage all files.</p></div>
<div class="sect2">
<h3 id="_integrating_with_the_orm_production_workflow">Integrating with the ORM production workflow</h3>
<div class="paragraph"><p>To actually "publish" your document through O&#8217;Reilly, you&#8217;ll need to get your files out of git and into the ORM production workflow, which is based on Subversion.  (You&#8217;ll also need an account for this, so talk to your editor about the process.)  You can find all the documentation about this process in the <a href="https://prod.oreilly.com/external/tools/docbook/docs/authoring/docbookguidelines_web.pdf">O&#8217;Reilly Production Guidelines</a>.</p></div>
<div class="paragraph"><p>Checking out the files looks something like this:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>svn checkout --username "odewahn@oreilly.com" "https://prod.oreilly.com/internal/books/sandbox_odewahn_RT79726/current/"</tt></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="title">Using "git svn"</div>
<div class="paragraph"><p>In theory, we should be able have git act like an svn client using "git svn" by doing something like this (see Chapter 8 from <em>Pro Git</em>):</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>git svn clone --username "odewahn@oreilly.com" "https://prod.oreilly.com/internal/books/sandbox_odewahn_RT79726/current/" -T trunk -b branches -t tags</tt></pre>
</div></div>
<div class="paragraph"><p>I don&#8217;t think this is going to work for us.  The main sticking point seems to be that git wants to make a complete history of all the changes that have happened on the repository, so it goes through several hundred thousand (literally!) different revisions.</p></div>
<div class="paragraph"><p>This takes a long time to complete&#8201;&#8212;&#8201;it has to go through almost 300K revisions.</p></div>
<div class="paragraph"><p>I wonder if there is a way to speed it up?  Maybe we could create a separate repository for just realtime projects, because this is really slow.  Tracking changes should be done in the git repo, and the subversion repo is only for publishing content, so it shouldn&#8217;t be very important.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_generating_a_pdf">Generating a PDF</h3>
<div class="paragraph"><p>You can generate a fresh PDF of your book every time you commit changes to the SVN
repository. To do so, run the following command (substituting your own message
before the semicolon):</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$ svn commit -m'Made some really important changes to Chapter 3; orm:commitpdf'</tt></pre>
</div></div>
<div class="paragraph"><p>To get the PDF, just run svn up on your working copy about 5–10 minutes after committing your files. The PDF will be downloaded as pdf/book.xml.pdf in your working copy. If there are any problems in generating the PDF, you’ll instead get a .buildlog file in the pdf/ directory that lists the errors</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="useful-links">Useful links</h2>
<div class="sectionbody">
<div class="paragraph"><p>These are various linke that I&#8217;ve found that help explain AsciiDoc, O&#8217;Reilly processes, and other stuff:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.apeth.net/matt/iosbooktoolchain.html">Matt Neuburg article on how to write a book using asciidoc</a>.  Nice article that explains how to do lots of good stuff.
</p>
</li>
<li>
<p>
<a href="http://powerman.name/doc/asciidoc">Asciidoc cheat sheet</a>.  Pretty much what it says&#8201;&#8212;&#8201;this shows you the markup in a no-nonsense kind of way.
</p>
</li>
<li>
<p>
<a href="https://prod.oreilly.com/external/tools/docbook/docs/authoring/docbookguidelines_web.pdf">O&#8217;Reilly Production Guidelines</a>.  Describes how to use the main O&#8217;Reilly subversion repository.
</p>
</li>
<li>
<p>
<a href="http://ryanflorence.com/git-for-beginners/">Looks like a pretty good intor to the basic features of git</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="git-notes">Appendix on git</h2>
<div class="sectionbody">
<div class="paragraph"><p>These are just some random notes about git&#8201;&#8212;&#8201;I need to add more in this section later as we start to develop some ideas about how to best use it.  Most of this is cribbed from Scott Chacon&#8217;s <a href="http://www.youtube.com/watch?v=OFkgSjRnay4">git in one hour</a> webcast.</p></div>
<div class="sect2">
<h3 id="_creating_a_repository">Creating a Repository</h3>
<div class="paragraph"><p>There are two ways to create a repository:</p></div>
<div class="ulist"><ul>
<li>
<p>
clone it from an exitsing repo
</p>
</li>
<li>
<p>
run "git commit -m <em>initial commit</em>"
</p>
</li>
<li>
<p>
use "git status" to get a status of working changes
</p>
</li>
<li>
<p>
use "git log" to get a log file of all commits
</p>
</li>
<li>
<p>
"git show" shows what the last commit was
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_adding_files">Adding Files</h3>
<div class="paragraph"><p>Next, you need to add files using "git add &lt;filename&gt;"</p></div>
</div>
<div class="sect2">
<h3 id="_more_commit_options">More commit options</h3>
<div class="paragraph"><p>Then you use "git commit -m <em>some message</em>" to commit the changes
You can also used "git add &lt;filename&gt;" to stage your commits, which means that you can commit in different groups.  this is helpful if you want to create a clear audit trail of what you were doing.</p></div>
<div class="ulist"><ul>
<li>
<p>
To just commit everything, you can use "git commit -a"
</p>
</li>
<li>
<p>
To commit stuff in steps, use "git add &lt;filename&gt;"
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_branches">Branches</h3>
<div class="paragraph"><p>git encourages you to do lots of little stuff inside branches, not just big stuff. For example, you might create a new branch to resolve a ticket, fix it in the branch, and then merge it back in later.  This is called a "topic branch".</p></div>
<div class="paragraph"><p>The command to see a branch is called "git branch".</p></div>
<div class="paragraph"><p>You can make a new branch using "git branch test" to create a new branch.  To work in the branch, you do "git checkout test".</p></div>
<div class="paragraph"><p>You can make any changes you want in the directory, and all changes happen in just that branch.  So, you can add files, make new changes, or whatever, and they&#8217;ll happen in only that one place.  Changes are saved at each commit.</p></div>
<div class="paragraph"><p>If you want to move back to another branch, all you have to do it check it back out and the files will look just as they did at the last commit point.</p></div>
<div class="paragraph"><p>You can view all the activity in the branches using "gitk".  This will pop up a ltille browser to go through all the changes on the branch you&#8217;re on.  You can use "gitk --all" to see the changes across all branches.</p></div>
</div>
<div class="sect2">
<h3 id="_merging">Merging</h3>
<div class="paragraph"><p>I need to review this section, but merging basically collapses two branches into a single branch.  You can then remove the topic branches using "git branch -d branch name" (double check this syntax)</p></div>
<div class="paragraph"><p>You do something to add a remote server</p></div>
<div class="paragraph"><p>You can then use "git fetch" to pull off some remote copy of the repository, but moves it into your repo as a separate branch.  This way you can inspect what someone else is doing, but not mess up your own work, which is really pretty cool.  You then merge that brach back in as you see fit.</p></div>
</div>
<div class="sect2">
<h3 id="_comparing_versions_of_files">Comparing versions of files</h3>
<div class="paragraph"><p>Use "git diff" to see the differences between the current version of the repo and the new verion.  You can use "git diff | mate" to see the diff visualized in textmate, which is pretty cool.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2011-03-12 19:18:10 EST
</div>
</div>
</body>
</html>
